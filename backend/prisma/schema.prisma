generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// States table matching states.csv
model State {
  id                String @id // GebietLandAbk (e.g., "BB", "BE")
  name              String // Gebietsname (e.g., "Brandenburg", "Berlin")
  
  candidates        Candidate[]
  constituencies    Constituency[]
  stateParties      StateParty[]
}

// Parties table matching parties.csv
model Party {
  id                Int    @id // PartyID
  shortName         String @unique // Gruppenname
  longName          String // GruppennameLang
  
  candidates        Candidate[]
  stateParties      StateParty[]
}

// Constituencies (Wahlkreis) table matching wahlkreis.csv
model Constituency {
  number            Int    @id // Gebietsnummer
  name              String // Gebietsname
  stateId           String // GebietLandAbk
  
  state             State  @relation(fields: [stateId], references: [id])
  candidates        Candidate[]
  ballots           Ballot[]
}

// Candidates table matching candidates.csv
model Candidate {
  id                Int      @id @default(autoincrement())
  title             String?  // Titel
  nameAddition      String?  // Namenszusatz
  lastName          String   // Nachname
  firstName         String   // Vornamen
  artistName        String?  // Künstlername
  gender            String?  // Geschlecht
  birthYear         Int?     // Geburtsjahr
  postalCode        String?  // PLZ
  city              String?  // Wohnort
  cityStateAbbr     String?  // WohnortLandAbk
  birthPlace        String?  // Geburtsort
  nationality       String?  // Staatsangehörigkeit
  profession        String?  // Beruf
  stateId           String   // GebietLandAbk
  partyShortName    String?  // GruppennameKurz
  listPosition      Float?   // Listenplatz
  constituencyNum   Int?     // Wahlkreis
  stateName         String?  // State
  firstVotes        Float?   // Erststimmen
  
  state             State         @relation(fields: [stateId], references: [id])
  party             Party?        @relation(fields: [partyShortName], references: [shortName])
  constituency      Constituency? @relation(fields: [constituencyNum], references: [number])
  firstVoteBallots  Ballot[]      @relation("FirstVoteCandidate")
}

// State parties (Zweitstimmen) table matching state_parties.csv
model StateParty {
  id                Int    @id @default(autoincrement())
  stateId           String // GebietLandAbk
  partyShortName    String // GruppennameKurz
  secondVotes       Float  // Anzahl
  
  state             State  @relation(fields: [stateId], references: [id])
  party             Party  @relation(fields: [partyShortName], references: [shortName])
  
  @@unique([stateId, partyShortName])
}

// Individual ballots (einzelne Stimmzettel)
model Ballot {
  id                Int       @id @default(autoincrement())
  constituencyNum   Int       // Wahlkreis
  voterId           Int       // Anonymized voter ID for this constituency
  firstVoteCandidateId Int?   // Erststimme (can be null for invalid vote)
  secondVoteParty   String?   // Zweitstimme party shortName (can be null for invalid vote)
  isFirstVoteValid  Boolean   @default(true)
  isSecondVoteValid Boolean   @default(true)
  createdAt         DateTime  @default(now())
  
  constituency      Constituency @relation(fields: [constituencyNum], references: [number])
  firstVoteCandidate Candidate? @relation("FirstVoteCandidate", fields: [firstVoteCandidateId], references: [id])
  
  @@index([constituencyNum])
  @@index([firstVoteCandidateId])
  @@index([secondVoteParty])
}